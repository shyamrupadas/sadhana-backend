# –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `users` —Å –ø–æ–ª—è–º–∏: id (UUID), email, password_hash, created_at, updated_at
- SQL –º–∏–≥—Ä–∞—Ü–∏—è: `src/db/migrations/001_create_users_table.sql`
- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π: `src/db/migrate.ts`
- –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏: `npm run migrate`

### 2. –ü–ª–∞–≥–∏–Ω—ã Fastify
- **env.ts** - –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
- **postgres.ts** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL (Neon)
- **jwt.ts** - JWT —Ç–æ–∫–µ–Ω—ã (access –∏ refresh)
- **cookie.ts** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ HTTP-only cookies

### 3. –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
- **AuthService** (`src/services/auth.service.ts`):
  - `register()` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª—è (bcrypt)
  - `login()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ credentials
  - `refreshAccessToken()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ access —Ç–æ–∫–µ–Ω–∞
  - `getUserById()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
  - `generateRefreshTokenForUser()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è refresh —Ç–æ–∫–µ–Ω–∞

### 4. API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ OpenAPI —Å—Ö–µ–º–µ:

#### POST /auth/register
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç access token –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç refresh token –≤ httpOnly cookie

#### POST /auth/login
- –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç access token –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç refresh token –≤ httpOnly cookie

#### POST /auth/refresh
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access —Ç–æ–∫–µ–Ω–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç refresh token –∏–∑ cookie
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π access token
- –û–±–Ω–æ–≤–ª—è–µ—Ç refresh token –≤ cookie

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **UnauthorizedError** (401) - –Ω–µ–≤–µ—Ä–Ω—ã–µ credentials –∏–ª–∏ —Ç–æ–∫–µ–Ω
- **BadRequestError** (400) - email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **NotFoundError** (404) - —Ä–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- –í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenAPI —Å—Ö–µ–º—ã

### 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º bcrypt (10 rounds)
- Refresh —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ httpOnly cookies (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
- JWT —Ç–æ–∫–µ–Ω—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ (access –∏ refresh)
- Access token: 15 –º–∏–Ω—É—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- Refresh token: 7 –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

### 7. TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–∏–ø—ã –∏–∑ `src/schema/generated.ts` (OpenAPI)
- –†–∞—Å—à–∏—Ä–µ–Ω—ã —Ç–∏–ø—ã Fastify –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ pg, jwt, cookies
- –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
DATABASE_URL=postgresql://...
JWT_SECRET=your-secret-key-change-in-production-min-32-chars
JWT_REFRESH_SECRET=your-refresh-secret-key-change-in-production-min-32-chars
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d
COOKIE_SECRET=your-cookie-secret-change-in-production
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç:
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ email, –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å)

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

- `@fastify/jwt` - JWT —Ç–æ–∫–µ–Ω—ã
- `@fastify/cookie` - cookies
- `@fastify/postgres` - PostgreSQL
- `@fastify/env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `bcrypt` - —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- `dotenv` - –∑–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–æ–≤

## üöÄ –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
npm run migrate

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –ü—Ä–æ–¥–∞–∫—à–Ω
npm start
```

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–°–º. `API.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é API.
